version: 0.2

phases:
  install:
    runtime-versions:
      python: 3.12
    commands:
      - echo "ðŸ“¦ Installing prerequisites"
      - git fetch --unshallow || echo "Repo already has full history"
      - pip install -r requirements.txt
      - ls -la .git || echo ".git folder not found!"
  build:
    commands:
      - echo "ðŸš€ Running static file upload"
      - chmod +x upload_static_assets.sh
      - echo "Checking environment $ENVIRONMENT_TYPE"
      - |
        # Set the correct bucket name based on ENVIRONMENT_TYPE
        if [ "$ENVIRONMENT_TYPE" == "BETA" ]; then
          BUCKET_NAME="s3-static-test-upload"
        elif [ "$ENVIRONMENT_TYPE" == "PROD" ]; then
          BUCKET_NAME="s3-test-static-artbuck"
        else
          echo "Unknown environment type! Please set ENVIRONMENT_TYPE to BETA or PROD."
          exit 1
        fi
        echo "Uploading static files to s3://$BUCKET_NAME/static/"
        changed_files=$(git diff --name-only HEAD^ HEAD -- static/)
        for file in $changed_files; do
          aws s3 cp "$file" "s3://$BUCKET_NAME/$file" --acl public-read
        done


artifacts:
  files:
    - '**/*'
